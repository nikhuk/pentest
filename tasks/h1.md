# H1 Vuohi, tappoketju ja pimeän verkon päiväkirjat
Niko Hukkanen **1.4.2022**

Haaga-Helia ammattikorkeakoulu

Kurssi: [Tunkeutumistestaus](https://terokarvinen.com/2021/penetration-testing-course-2022-spring/)

Kurssin opettaja: [Tero Karvinen](https://terokarvinen.com/contact)

## Harjoituksessa käytetyt laitteet ja järjestelmät

 - Lenovon Legion Y540 kannettava tietokone (Intel i7-9750H CPU, RAM 16GB, Nvidia GTX 1660 Ti GPU, Host OS: Win 11 )
 - Oracle VM VirtualBox 6.1.32.
 - VM: Kali Linux
## Tiivistelmät
[Hutchins et al 2011: Intelligence-Driven Computer Network Defense Informed by Analysis of Adversary Campaigns and Intrusion Kill Chains](https://lockheedmartin.com/content/dam/lockheed-martin/rms/documents/cyber/LM-White-Paper-Intel-Driven-Defense.pdf)  _Abstract_  sekä kappaleet 3.2  _Intrusion Kill Chain_  ja 3.3  _Courses of Action_.
 
 - Aikaisempaa kehittyneempiä uhkia on tiedossa, sekä niiden tekemiseen
   käytetään kehittyneitä työkaluja ja metodeja. 
  
 - Hyökkäykset voivat olla kestoltaan hyvin pitkiä, niissä käytetään
   monta vuotta kestäviä tunkeutumiskampanjoita.
   
 - Tappoketjulla (Kill Chain) tarkoitetaan systemaattista prosessia, jossa kohdennetaan ja hyökätään vastustajan järjestelmiä vastaan.
 - Ketju luo kehyksen hyökkäyksien toteutuksille.


[Darknet Diaries](https://darknetdiaries.com/episode/73/) podcast **Episode 73 :WannaCry**

 - Jaksossa käsitellään vuonna 2017 tapahtunutta kyberhyökkäystä, jossa käytettiin WannaCry nimistä kiristyshaittaohjelmaa.
 - Kiristyshaittohjelma WannaCry lukitsi Windows koneita käyttökelvottomiksi, se myös vaati lunnaaksi Bitcoin kryptovaluutta koneiden kryptauksen poistoon. 
 - Hyökkäys kohdistui terveyspalveluihin ja sairaaloihin Englannissa, tarkemmin heidän koneisiin joissa käytettiin Windows käyttöjärjestelmiä.
 - Jaksossa on vieraana terveysalantyöntekijä, joka oli töissä hyökkäyksen aikana.
 - Vieraan mukaan sairaaloissa jouduttiin palaamaan vanhanaikaisiin toimintatapoihin, kuten kirjaamaan käsin potilaisiin liittyviä tietoja. Kiristysohjelma teki potilastietojärjestelmistä käyttökelvottomia, johtuen kyseisestä kiristyshaittaohjelmasta.
 - Vaikutus oli suuri, mutta kaikkein kriitisimpiä järjestelmiä pystyi käyttämään, koska ne eivät olleet kytkettynä samaan verkkoon missä hyökkäystapahtui.
 - Toinen vieras kuvaili tilannetta kauheaksi, koska haittaohjelma levisi verkon välityksellä. Hän myös odotti silloin että kyseinen kiristyshaittaohjelma voisi levitä vielä sairaaloista muihin paikkoihin. 
 

## Kali Linuxin asentaminen
Aloitin tehtävät asentamalla Kali Linux virtuaalikoneen, jotta pääsen suoraan työskentelemään sen kanssa tulevissa tehtävissä. 
Latasin ISO kuvan seuraavasta osoitteesta [Kali Linux](https://www.kali.org/get-kali/#kali-bare-metal). 
Ladattuani ISO kuvan siirryin asentamaan Kali Linux virtuaalikonetta Oracle VM Virtualboxissa.
Annoin seuraavat asetukset virtuaalikoneelle:

![kaliasetukset](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasetukset.png?raw=true)

Seuraavaksi liitin ISO tiedoston virtuaalikoneeseeni, jotta pääsin asentamaan sitä.

![kailiiso](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliiso.png?raw=true)

Valitsin Graaffisen asennuksen suortittamisen.

![kaliasennus1](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus1.png?raw=true)

Kieleksi valitsin Englannin kielen.

![kaliasennus2](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus2.png?raw=true)

Alueeksi valitisin Suomen

![kaliasennus3](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus3.png?raw=true)

Näppäimistön kieleksi valitsin Suomen.

![kaliasennus4](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus4.png?raw=true)

Hostnameksi valitsin: "katu"

![kaliasennus5](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus5.png?raw=true)

Domain name kohdan jätin tyhjäksi.

![kaliasennus6](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus6.png?raw=true)

Loin uuden käyttäjän.

![kaliasennus7](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus7.png?raw=true)

Käyttäjänimeksi päätin valita etunimeni.

![kaliasennus8](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus8.png?raw=true)

Annoin käyttäjälle salasanan.

![kaliasennus9](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus9.png?raw=true)

Koko levyn käyttö ilman salausta.

![kaliasennus10](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus10.png?raw=true)

Valitsin levyksi VBoxin levyn.

![kaliasennus11](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus11.png?raw=true)

En jakanut levyä osioihin.

![kaliasennus12](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus12.png?raw=true)

Jatkoin painamalla Continue.

![kaliasennus13](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus13.png?raw=true)

Vahvistin asetukset.

![kaliasennus14](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus14.png?raw=true)

Valitsin ohjelmistoista itselleni tutut valinnat, jotka olivat jo valmiiksi valittuna.

![kaliasennus15](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus15.png?raw=true)

GRUB boot loader asennus.

![kaliasennus16](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus16.png?raw=true)

Asennus aikaisemmin luodulle levylle.

![kaliasennus17](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus17.png?raw=true)

Asennus oli valmistunut.

![kaliasennus18](https://github.com/nikhuk/pentest/blob/main/assets/h1/kaliasennus18.png?raw=true)

![paivitukset](https://github.com/nikhuk/pentest/blob/main/assets/h1/kalipaivitus.png?raw=true)
Omasta mielestäni Kali Linux käyttöjärjestelmän asennus oli helppo tehdä. Se oli hyvin samankaltainen kuin aikaisemmat Linux käyttöjärjestelmä asennukset, joita olen esimerkiksi tehnyt [aikaisemmalla kurssilla](https://github.com/nikhuk/linuxpalvelimet/wiki/H7#linux-asennus).

Lopussa kun olin saanut Kali Linux virtuaalikoneen asennettua, päätin vielä asentaa uusimmat päivitykset ja poistaa päällekäisyydet komennoilla:

    sudo apt-get update 
    sudo apt-get full-upgrade -y
    sudo apt-get autoremove
Päivitysten jälkeen koin olevani valmis käyttämään luomaani virtuaalikonetta tulevissa tehtävissäni.

## a) Ratkaise [Over The Wire: Bandit](https://overthewire.org/wargames/bandit/) viisi ensimmäistä tasoa (0-4).
## Taso 0
Ensimäisellä tasolla tulee ottaa SSH yhteys seuraavaan osoitteeseen: **bandit.labs.overthewire.org** ja tarkemmin vielä porttiin: **2220** Käyttäjänimenä on **bandit0** ja salasana on: **bandit0**

SSH Yhteyden muodostaminen onnistui seuraavalla tavalla:

    ssh -p 2220 bandit0@bandit.labs.overthewire.org
Taso 0 suoritettu.

![bandit0](https://github.com/nikhuk/pentest/blob/main/assets/h1/bandit0.png?raw=true)

## Taso 1

Salasana seuraavaan tasoon löytyi kotihakemistosta tiedostosta "readme".  boJ9jbbUNNfktd78OOpsqOltutMc3MY1
Tulostin salasanan käyttämällä "cat" komentoa, joka tulostaa tiedoston sisällön.

![bandit1](https://github.com/nikhuk/pentest/blob/main/assets/h1/bandit1.png?raw=true)

## Taso 2
Otin SSH yhteyden ja kirjauduin bandit1 käyttäjälle käyttämällä aikaisemmin löytämääni salasanaa komennolla:

    ssh -p 2220 bandit1@bandit.labs.overthewire.org
 
Tässä tehtävässä jouduin etsimään tietoa kuinka tulostaa - tiedoston sisältöä, löysyin tähän vastauksen [stackoverflowsta](https://stackoverflow.com/questions/42187323/how-to-open-a-dashed-filename-using-terminal).

![bandit2](https://github.com/nikhuk/pentest/blob/main/assets/h1/bandit2.png?raw=true)

Lopulta sain tulostettua salasanan: CV1DtqXWVFXTvM2F0k09SHz0YwRINYA9

## Taso 3
Otin SSH yhteyden ja kirjauduin bandit2 käyttäjälle käyttämällä aikaisemmin löytämääni salasanaa seuraavalla komennolla:

    ssh -p 2220 bandit2@bandit.labs.overthewire.org
Listaamalla tiedostot "ls" komennolla löysin yhden tiedoston, joten kirjoitin cat komennon tulostaakseni sen.  Kun olin kirjoittanut "cat" painoin tab näppäintä ja huomasin, että kyseissä tiedostossa on välejä ja \ merkkkejä, vaikka en nähnyt niitä alkuperäisessä nimessä. Joka tapauksessa cat tulosti seuraavan salasanan.

![bandit3](https://github.com/nikhuk/pentest/blob/main/assets/h1/bandit3.png?raw=true)

Salasana: UmHadQclWmgdLOKQ3YNgjWxGoRMb5luK

## Taso 4
Otin SSH yhteyden ja kirjauduin bandit3 käyttäjälle käyttämällä aikaisemmin löytämääni salasanaa seuraavalla komennolla:

    ssh -p 2220 bandit3@bandit.labs.overthewire.org


![bandit4](https://github.com/nikhuk/pentest/blob/main/assets/h1/bandit4.png?raw=true)

Jälleen listasin tiedostot kotihakemistossa, josta löytyi kansio "inhere" siirryin kyseiseen kansioon komennolla `cd inhere/`.
Tämän jälkeen päätin tulostaa .hidden tiedoston sisällön, josta löytyi seuraava salasana.
Salasana: pIwrPrtPN36QITSp3EQaw936yaFoFgAB
## Taso 5
Otin SSH yhteyden ja kirjauduin bandit4 käyttäjälle käyttämällä aikaisemmin löytämääni salasanaa seuraavalla komennolla:

    ssh -p 2220 bandit4@bandit.labs.overthewire.org
Jälleen listasin tiedostot kotihakemistossa, josta löytyi kansio "inhere" siirryin kyseiseen kansioon komennolla `cd inhere/`.
Kansiosta löytyi 10 erilaista tiedostoa. Ajattelin tulostaa jokaisen sisällön yksitellen, koska niitä oli niin vähän mielestäni.
 
![bandit5](https://github.com/nikhuk/pentest/blob/main/assets/h1/bandit5.png?raw=true)

Kun pääsin tiedostoa -file07 sieltä löytyi seuraavanlainen salasana: koReBOKuIDDepwhWk7jZC0RTdopnAYKh

## Asenna WebGoat, luo paikallinen WebGoat-käyttäjä ja kirjaudu sisään
Käytin WebGoatin asennuksessa ohjeena Teron [ohjetta](https://terokarvinen.com/2020/install-webgoat-web-pentest-practice-target/).
Aloitin asentamalla Javan ja UFW palomuurin.
Komennolla:  `sudo apt-get -y install openjdk-11-jre ufw`
Tämän jälkeen otin käyttöön UFW palomuurin komennolla: `sudo ufw enable`
Seuraavaksi latasin wgetin avulla paketin WebGoatista komennolla: `wget https://github.com/WebGoat/WebGoat/releases/download/v8.0.0.M26/webgoat-server-8.0.0.M26.jar`
Tämän jälkeen ajoin kyseisen paketin Javalla komennolla: `java -jar webgoat-server-8.0.0.M26.jar`
Huomasin että webgoat oli lähtenyt päälle kun ajoin sen, seuraavaksi siirryin osoitteeseen `http://localhost:8080/WebGoat/login`.
![webgoat](https://github.com/nikhuk/pentest/blob/main/assets/h1/webgoat.png?raw=true)
Seuraavaksi loin tunnukset webgoatiin, jotta pääsen tekemään seuraavia harjoituksia.
![webgoat2](https://github.com/nikhuk/pentest/blob/main/assets/h1/webgoat2.png?raw=true)
Omien tunnuksien rekisteröinti onnistui ja pääsin sisään WebGoatiin.

## Ratkaise WebGoatista tehtävät

## HTTP Basics
Kun olin saanut WebGoatin asennettua ja rekistöröityä omat tunnukseni oli tehtävien vuoro.
![http1](https://github.com/nikhuk/pentest/blob/main/assets/h1/http1.png?raw=true)
Ensimmäisessä tehtävässä piti täyttää kohta omalla nimellä. Tämän jälkeen palvelin vastaannotti nimeni väärinpäin.

![http2](https://github.com/nikhuk/pentest/blob/main/assets/h1/http2.png?raw=true)
Löysin taika numeron post requestista nimeltä attack2.


## Developer tools
Tehtävien toinen osio
![dev1](https://github.com/nikhuk/pentest/blob/main/assets/h1/devconsole.png?raw=true)

Ohjeessa pyydetään kutsumaan javascript funktiota `webgoal.customjs.phoneHome()`. Kun kutsun suorittaa se vastaa numerolla, joka löytyy konsolista.

![dev2](https://github.com/nikhuk/pentest/blob/main/assets/h1/devnetwork.png?raw=true)

Tehtävien ratkaisussa meni hiukan odotettua kauemmin, koske en ollut hetkeen käyttänyt Devtool työkaluja web sivujen analysoinnissa.
##  [Challenge.fi](https://challenge.fi/): 2021 Where was this picture taken.
[Linkki tehtävään](https://2021.challenge.fi/#What%27s%20in%20this%20picture?%201/2-49).
En ole aikaisemmin etsinyt Linuxilla enempää dataa valokuvasta, joten päädyin etsimään lisätietoa kyseisestä aiheesta Googlesta. Löysin hyvän artikkelin, josta löytyy ohjeet kuvien metadatan katseluun. [Linkki artikkeliin](https://ostechnix.com/how-to-view-image-metadata-on-linux/).
Artikkelissa suositellaan käyttämään ImageMagick ohjelmaa, jolla pystyy avaamaan kuvatiedostojen metadataa helposti komennolla `identify`.
Asensin kyseisen ohjelman komennolla: `sudo apt-get install imagemagick`.
Kun ohjelma oli asentunut latasin Challenge. fi osoitteesta kuvan `e.jpg`. Kyseisestä kuvasta piti selvittää se, että missä se on otettu.
Avasin terminaalin Downloads kansiooni ja kirjoitin seuraavan komennon: `indentify -verbose e.jpg`.

![challenge](https://github.com/nikhuk/pentest/blob/main/assets/h1/challenge.png?raw=true)

    exif:GPSAltitude: 271/5
    exif:GPSAltitudeRef: 0
    exif:GPSDateStamp: 2017:11:15
    exif:GPSDop: 1846/125
    exif:GPSInfo: 6114
    exif:GPSLatitude: 53/1, 23/1, 1851/625
    exif:GPSLatitudeRef: N
    exif:GPSLongitude: 1/1, 28/1, 49107/2500
    exif:GPSLongitudeRef: W
    exif:GPSProcessingMethod: 65, 83, 67, 73, 73, 0, 0, 0, 102, 117, 115, 101, 100
    exif:GPSTimeStamp: 8/1, 8/1, 20/1
    exif:GPSVersionID: 2, 2, 0, 0
Kuvasta löytyi paljon metatietoja, mutta myös GPS koordinaatit sinne missä kuva on otettu. Koordinaattejen muuntamiseen käytin apuna seuraavaa sivustoa [Techbout](https://www.techbout.com/find-location-where-photo-was-taken-17094/). Tässä vaiheessa siirryin Googlen Maps hakuun ja syötin  GPS Latitude ja Longitude tiedot hakukentään. Tulokseksi sain seuraavan paikan:

![gpslocation](https://github.com/nikhuk/pentest/blob/main/assets/h1/gpslocation.png?raw=true)

Löysin GPS koordinaateilla seuraavanlaisen paikan. **+53.384156,-1.472123 = 53°23'03.0"N 1°28'19.6"W**
Osoite: **Griffin House, 41 Silver Street Head, Sheffield City Centre, Sheffield, Englanti.**
Koin itse vaikeuksia tehtävässä GPS koordinaattejen kanssa, koska en ole aikaisemmin käyttänyt niitä lähes tulkoon mihinkään. Omasta mielestäni lopussa löysin oikean paikan koordinaattejen perusteella.

## TryHackMe tai HackTheBox. Rekisteröidy, lue ja tallenna säännöt, avaa OpenVPN-yhteys, ratkaise yksi tehtävä (tai tehtävän alakohta) jommasta kummasta palvelusta: [TryHackMe](https://tryhackme.com/) tai [HackTheBox](https://www.hackthebox.com/)
Päätin valita TryHackMe palvelun näistä kahdesta vaihtoehdosta, koska sitä suositeltiin aloittelijoille. Rekistöröinti kyseiseen palveluun tapahtui helposti, eikä se vaatinut erikoisuuksia.

Aloitin TryHackMe käytön tekemällä Pentesting Fundamentals harjoituksen.

![tryhackme4](https://github.com/nikhuk/pentest/blob/main/assets/h1/tryhackme4.png?raw=true)

Päädyin lopulta suorittamaan ensimmäiset kaksi harjoitusta Pentesting Fundamentals ja Principles of Security kokonaisuudessaan, eli kokonaisuudessaan Introduction to Pentesting osion.

OpenVPN 
Latasin [TryHackMe](https://tryhackme.com/) sivustolta OpenVPN konfigurointi tiedoston, tämän jälkeen asensin OpenVPN ohjelman komennolla `sudo apt-get install openvpn`. Asennettuani OpenVPN ohjelman siirryin ajamaan lataamaani kongfigurointi tiedosta, ajoin sen komennolla: `sudo openvpn nikhuk.ovpn`.

![openvpn](https://github.com/nikhuk/pentest/blob/main/assets/h1/openvpn.png?raw=true)

Sain OpenVPN yhteyden toimimaan ilman ongelmia.


## Lähteet

 - https://terokarvinen.com/2021/penetration-testing-course-2022-spring/
 - https://lockheedmartin.com/content/dam/lockheed-martin/rms/documents/cyber/LM-White-Paper-Intel-Driven-Defense.pdf
 - https://darknetdiaries.com/episode/73/
 - https://www.kali.org/get-kali/#kali-bare-metal)
 - https://github.com/nikhuk/linuxpalvelimet/wiki/H7#linux-asennus
 - https://overthewire.org/wargames/bandit/
 - https://stackoverflow.com/questions/42187323/how-to-open-a-dashed-filename-using-terminal
 - https://terokarvinen.com/2020/install-webgoat-web-pentest-practice-target/
 - https://owasp.org/www-project-webgoat/
 - https://ostechnix.com/how-to-view-image-metadata-on-linux/
 - https://www.techbout.com/find-location-where-photo-was-taken-17094/
 - https://tryhackme.com/
