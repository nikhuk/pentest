# H6 Final Countdown
Niko Hukkanen **14.5.2022**

Haaga-Helia ammattikorkeakoulu

Kurssi: [Tunkeutumistestaus](https://terokarvinen.com/2021/penetration-testing-course-2022-spring/)

Kurssin opettaja: [Tero Karvinen](https://terokarvinen.com/contact)

## Harjoituksessa käytetyt laitteet ja järjestelmät

 - Lenovon Legion Y540 kannettava tietokone (Intel i7-9750H CPU, RAM 16GB, Nvidia GTX 1660 Ti GPU, Host OS: Win 11 )
 - Oracle VM VirtualBox 6.1.32.
 - VM: Kali Linux 

## a) Middle. Muuta hakupyyntöä välimiesproxylla.

Päätin tehdä samankaltaisen hakupyynnön muutoksen välimiesproxylla, kuin luennolla oli aikaisemmin esitetty. Eli muutetaan Googlen hakutuloksia muuttamalla `GET /search` pyyntöä, silloin kuin hakupyyntöä lähetetään Googlelle.

Päätin käyttää aikaisemmin tunnilla käyttämääni [Burp](https://portswigger.net/burp/communitydownload) työkalua, olin aikaisemmin ladannut kyseisen työkalun suoraan heidän verkkosivuiltaan. Burp on maksullinen työkalu, josta löytyy myös maksuton versio nimeltä: **Burp Suite Community Edition**. Latasin työkalun [tästä linkistä](https://portswigger.net/burp/releases/professional-community-2022-3-7?requestededition=community&requestedplatform=).

Aloitin hakupyynnön muokkaamisen käynnistämällä Burp työkalun Kali virtuaalikoneellani.

![burp1](https://raw.githubusercontent.com/nikhuk/pentest/452e34286e9ba8ecf33c469a40c671b5ae362d99/assets/h6/burp1.png)

Burpin ilmaisversiossa ei voi luoda projektia, tai jatkaa aikaisemmin luotua ja tallennettua projektia.

![burp2](https://github.com/nikhuk/pentest/blob/main/assets/h6/burp2.png?raw=true)

Konfiguroinnissa valitsin käyttöön Burp oletusasetukset. Tämän jälkeen painoin kohdasta "Start Burp".


![burp3](https://github.com/nikhuk/pentest/blob/main/assets/h6/burp3.png?raw=true)

Käynnistyksen jälkeen siirryin Burpissa kohtaan "proxy" ja valitsin Intercept kohdan. Tämän jälkeen käynnistin selaimen kohdasta "Open Browser", jossa aukeaa Chromium selain johon on valmiiksi säädettty proxy asetukset, sekä muut tarvittavat konfiguraatiot.

Seuraavaksi siirryin selaimessa Googlen hakupalveluun, jossa tapahtuisi hakutuloksen muuttaminen.

Päätin muuttaa hakutuloksia seuraavanlaisesti: Haen Googlesta hakusanalla **haaga-helia**, mutta muutan sen näyttämään tuloksena **terokarvinen** hakutuloksia.

Kun olin siirtynyt selaimessa Googlen sivustoille, käynnistin Burp työkalun intercept ominaisuuden.

![burp4](https://github.com/nikhuk/pentest/blob/main/assets/h6/burp4.png?raw=true)

Etsin proxyn läpikulkevan liikenteen joukosta `GET /search` pyynnön, joka on hakupyyntö Googlelle.

![burp5](https://github.com/nikhuk/pentest/blob/main/assets/h6/burp5.png?raw=true)

Seuraavaksi muutin löytämääni `GET /search` pyyntöä seuraavanlaisesti: korvasin aikaisemmat viittaukset **haaga-heliaan** riviltä 1. Korvasin kyseiset kohdat tekstillä: **terokarvinen**. Kun olin muokannut seuraavat kohdat riviltä 1 painoin Foward painiketta, joka lähettää muokatun `GET /search` pyynnön eteenpäin Googlelle.

![burp6](https://github.com/nikhuk/pentest/blob/main/assets/h6/burp6.png?raw=true)


Hakutuloksen URL: `https://www.google.com/search?q=haaga-helia&source=hp&ei=uUF-YviDC-GRrgSpwaegCw&iflsig=AJiK0e8AAAAAYn5PybOgncdrgdA3AHaBFvixKmFj1win&ved=0ahUKEwi4xO-ysNz3AhXhiIsKHangCbQQ4dUDCAc&oq=haaga-helia&gs_lcp=Cgdnd3Mtd2l6EAMyCAguEIAEENQCMgUIABCABDILCC4QgAQQxwEQrwEyCAgAEIAEEMkDMgUIABCABDIFCAAQgAQyBQgAEIAEMgUIABCABDIFCAAQgAQyBQgAEIAEOgsIABCABBCxAxCDAToRCC4QgAQQsQMQgwEQxwEQowI6EQguEIAEELEDEIMBEMcBENEDOgsILhCABBCxAxDUAjoFCC4QgAQ6CAguELEDEIMBOgsILhCABBCxAxCDAToICC4QgAQQsQM6DgguEIAEELEDEIMBENQCOggIABCABBCxAzoOCC4QgAQQxwEQrwEQ1AJQhw9Yzhxgi1ZoAnAAeACAAWeIAfQFkgEEMTAuMZgBAKABAbABAA&sclient=gws-wiz&uact=5`

Hakutuloksen URL kohdassa näkyy, että haku koskisi edelleen "haaga-helia" hakua. Mutta itse sisältö näyttää hakutuloksen sanalle terokarvinen.

**Lopputulos**
Sain vaihdettua oman tekemäni Google hakutuloksen välimiesproxyn avulla.


## b) Cheatsheet - kerää parhaat kikat, käskyt ja tekniikat omasta ja toisten raporteista. (tässä alakohdassa pelkkä kirjoitus riittää, ei tarvitse testata koneella)

**Nmap komennot**

`-sV`: Versio/palveluskannaus
`-oA`: Tulostaa tuloksen kolmeen eri tiedostomuotoon.
`-p`: Kohdistaa skannauksen tiettyyn porttiin tai useampaan määriteltyyn porttiin.
`-sT`: TCP-skannaus kolmivaiheisen kättelyn avulla.
`-sS`: "hiljainen" skannaus, ilman kokonaista TCP yhteyttä. Ainoastaan SYN lippujen käyttö.
`-sn`: Verkonskannaus, jolla määritellään verkossa aktiivisina olevat päätelaitteet. Skannattavat IP-osoitteet voidaan rajata verkkomaskin tai IP-osoitteiden välillä 10.0.0.1-254.
`-sU`: UDP-skannaus

Lähde: [Stationx](https://www.stationx.net/nmap-cheat-sheet/)

**Metasploit komennot**
`msfdb init`: Tietokannan käyttöönotto.
`search`: Haku toiminto, jolla voidaan hakea valmiita haavoittuvuuksia eri palveluihin.
`show options`: Näyttää asetukset nykyiselle exploitille.
`use exploit`: Määritellään käytettävä hyökkäys.
`show payload`: Näyttää hyökkäyskuorman vaihtoehdot.
`set payload`: Valitaan käytettävä hyökkäyskuorma.
`set RHOST`: Valitaan kohde IP-osoitteella.
`set RPORT`: Määritellään kohde portti.
`exploit`: Käynnistetään hyökkäys.

Lähde: [Security Cheat Sheet (GitHub)](https://github.com/security-cheatsheet/metasploit-cheat-sheet)

## d) Kaikki tehtävät tähän. Listaa suora linkki kuhunkin palautukseesi.

Kaikki tehtävät löytyvät GitHubin wiki sivustolta: [pentest wiki](https://github.com/nikhuk/pentest/wiki), sekä myös GitHub sivuston code osiosta kohdasta [tasks](https://github.com/nikhuk/pentest/tree/main/tasks) Markdown tiedostoina.

**H1 Vuohi, tappoketju ja pimeän verkon päiväkirjat:** https://github.com/nikhuk/pentest/wiki/H1
**H2 turbo boosted:** https://github.com/nikhuk/pentest/wiki/H2
**H3 Attaaack!:** https://github.com/nikhuk/pentest/wiki/H3
**H4 Tiedustelua:** https://github.com/nikhuk/pentest/wiki/H4
**H5 Script Kiddie:** https://github.com/nikhuk/pentest/wiki/H5
**H6 Final Countdown:** https://github.com/nikhuk/pentest/wiki/H6

## g) Vapaaehtoinen, HackStation 3000: Valmistele kone viimeisen kerran arvioitavaan labraan. Saat asentaa koneelle etukäteen mitä ohjelmia haluat ja tehdä haluamiasi asetuksia. Jos ohjelmat eivät ole yleisessä käytössä olevia vapaita ohjelmia, niistä pitää toimittaa opettajalle tarvittaessa luvallinen kopio (jos se ei jostain ohjelmasta onnistu, käytä jotain toista ohjelmaa). Koneella ei saa olla luottamuksellisia tietoja, koska labrassa kerätään automaattisesti tietoja koneelta

Asensin arvioitavaa labraa varten uuden Kali Linux virtuaalikoneen, jonka tein samalla tavalla kuin tämän kurssin tehtävässä **H1 Vuohi, tappoketju ja pimeän verkon päiväkirjat:** . Itse koneelle en asentanut lisäohjelmia tai muuttanut asetuksia.

Ainoat tekemäni muutokset Kali virtuaalikoneelle, olivat viimeisimpien päivityksien asentaminen seuraavanlaisilla komennoilla:

    sudo apt-get update
    sudo apt-get upgrade
    sudo apt-get autoremove
    
Päätin tämän jälkeen, että Kali Linux virtuaalikoneeni on valmis viimeiseen labraan.

## Lähteet

 - https://terokarvinen.com/2021/penetration-testing-course-2022-spring/
 - https://portswigger.net/burp/communitydownload
 - https://portswigger.net/burp/releases/professional-community-2022-3-7?requestededition=community&requestedplatform=
 - https://github.com/nikhuk/pentest/wiki
 - https://www.stationx.net/nmap-cheat-sheet/'
 - https://github.com/security-cheatsheet/metasploit-cheat-sheet
 - https://www.kali.org/get-kali/
 - https://github.com/nikhuk/pentest/wiki/H1