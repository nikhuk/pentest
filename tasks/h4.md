
# H4 Tiedustelua
Niko Hukkanen **30.4.2022**

Haaga-Helia ammattikorkeakoulu

Kurssi: [Tunkeutumistestaus](https://terokarvinen.com/2021/penetration-testing-course-2022-spring/)

Kurssin opettaja: [Tero Karvinen](https://terokarvinen.com/contact)

## Harjoituksessa käytetyt laitteet ja järjestelmät

 - Lenovon Legion Y540 kannettava tietokone (Intel i7-9750H CPU, RAM 16GB, Nvidia GTX 1660 Ti GPU, Host OS: Win 11 )
 - Oracle VM VirtualBox 6.1.32.
 - VM: Kali Linux ja Metasploitable 2

## z) Lue artikkelit ja katso videot, tee kustakin muistiinpanot (muutama ranskalainen viiva per artikkeli/video). Tässä z-kohdassa ei tarvitse tehdä mitään kokeita koneella.

**€ Santos et al: The Art of Hacking (Video Collection): [..]  [4.3 Surveying Essential Tools for Active Reconnaissance](https://learning.oreilly.com/videos/the-art-of/9780135767849/9780135767849-SPTT_04_00). Sisältää porttiskannauksen. 5 videota, yhteensä noin 20 min.**

 - Aktiivinen tiedustelussa lähetetään tietoa kohteeseen, josta voi jäädä tietoa tiedustelun kohteelle.
 - Porttiskannauksen työkaluja: Nmap, Masscan ja Udpprotoscanner.
 - Näistä suosituin on Nmap, siitä löytyy myös paljon erilaisia ominaisuuksia.
 - Masscan on nopea työkalu skannauksen toteutukseen.
 - UDPprotoscanner skannaa UDP-protokollaa.
 - Webservice review Verkkopalve EyeWitness avulla voidaan nopeuttaa kohdennusta ja niiden läpikäyntiä. Hyödyllinen varsinkin tilanteissa, joissa kohteessa on liuta erilaisia verkkosivuja.
 - Haavoittuvuus skannereita on kahdenlaisia toiset keskittyvät verkonhaavoittuvuuksien skannaamiseen toiset, toiset taas weppi palveluiden haavoittuvuuksien skannaamiseen.
 - Nmapilla voi myös ajaa scriptejä, joiden avulla voidaan selvittää haavoittuvuuksia.

**Lyon 2009: Nmap Network Scanning:  [Chapter 1. Getting Started with Nmap](https://nmap.org/book/nmap-overview-and-demos.html)  Suoraan hevosen suusta: Gordon Lyon aka Fyodor Vaskovich on kirjoittanut tuon menestyneen kirjan lisäksi nmapin. Kirja maksaa 40 eur, mutta reiluna kaverina Gordon oli laittanut juuri tähän sopivat luvut ilmaiseksi nettiin.**

 - Tekstissä havainnollisettaan Nmapin käyttöä esimerkkitapauksen avulla, jossa skannataan yhden verkkopelin palveluiden haavoittuvuuksia.
 - Testaus aloitetaan IP-osoitteiden selvityksellä Nmapin avulla.
 - IP-osoitteiden selvityksen jälkeen, ne vielä varmistetaan toimeksiantajalta oikeiksi, jotta oltaisiin varmoja kohteesta.
 - Porttiskannaus, sekä selvitetään käyttöjärjestelmät kohteesta.
 - Kyseisessä tekstissä kuvaillaan erityisen hyvin Nmapin käyttöä.

**Silmäile (ei tarvitse lukea kokonaan, 40 liuskaa pitkä): Lyon 2009: Nmap Network Scanning: Chapter 15.  [Nmap Reference Guide](https://nmap.org/book/man.html).**
**[Port Scanning Basics](https://nmap.org/book/man-port-scanning-basics.html)  (opettele, mitä tarkoittavat: open, closed, filtered; muuten vain silmäily)**

 - Open: Tarkoittaa porttia joka hyväksyy liikennettä, ja sen päästä löytyy siihen vastaava palvelu. Kyseinen open lauseke kiinnittää erityisesti hyökkääjien huomion, koska se voi mahdollistaa kyseisen palvelun väärinkäytön.
 - Closed:  Vastaa Nmapin paketteihin, mutta siellä ei ole käynnissä olevaa palvelua, joka vastaisi niihin.
 - Filtered: Ei pystytä päättelemään onko portissa käytössä oleva palvelu vai ei. Yleinen vastaus silloin, kun käytössä on palomuuri, tai myös reititin voi vaikuttaa tähän.

**[Port Scanning Techniques](https://nmap.org/book/man-port-scanning-techniques.html)  (opettele, mitä ovat: -sS -sT -sU; muuten vain silmäily)**

 - -sS Skannaus lähettää SYN lippuja kohdeportteihin. Yksi yleisimmistä skannaustavoista. Ei muodosta TCP yhteyttä. Vähemmän äänekäs tapa skannaukselle.
 - -sT TCP skannaus, joka muodostaa TCP yhteyden kohteeseen, luodaan SYN - SYN ACK -ACK -RST lippuja käyttäen. Äänekäs tapa skannaukselle, jättää mahdollisesti jäljen skannauksesta.
 - sU Skananaus UDP protokollaa käyttävien palveluiden selvittämiseksi.

**Silmäile (ei tarvitse lukea kokonaan): man nmap**

## Nmap
Tehtävässä koneet ovat samassa lähiverkossa keskenään, ilman yhteyttä internettiin.
Kyseiseen lähiverkkoon on liitetty kaksi virtuaalikonetta: Kali ja Metasploitable 2.

## a) nmap TCP connect scan -sT

Yksi yleisimmistä Nmapin skannaus menetelmistä, jossa muodostetaan TCP yhteys [kolmivaiheisen kättelyn](https://www.techopedia.com/definition/10339/three-way-handshake) avulla. Kyseisessä menetelmässä yhteys muodostetaan vaihtamalla seuraavia lippuja: ` SYN - SYN ACK -ACK -RST`, TCP yhteyden muodostamiseksi.
Ajoin skannauksen komennolla: `sudo nmap -sT -p 80 192.168.180.5`.

![nmap1](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap1.png?raw=true)

Kohdensin haun porttiin 80, jotta Wireshark ohjelmaan ei tulisi kauhean pitkää tulostetta.

![nmap2](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap2.png?raw=true)

Liikenteessä näkyi verkossa liikkuvaa ARP liikennettä, sekä TCP yhteyden muodostus kolmivaiheisen kättelyn avulla riveillä 3-5. Yhteyden lopetus näkyi rivillä 6.

## b) nmap TCP SYN "used to be stealth" scan, -sS (tätä käytetään skannatessa useimmin)

Kyseinen skannaus lähettää ainoastaan yhteyden avaamiseen tarkoitetun `SYN` lipun . Tarkoituksena on testata, että saadaanko kyseiselle lipulle vastausta SYN ACK sanoman muodossa.
Ajoin skannauksen komennolla: `sudo nmap -sS -p 80 192.168.180.5`.

![nmap3](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap3.png?raw=true)

Wireshark verkonkaappaus.

![nmap4](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap4.png?raw=true)

Wiresharkin kaappauksessa näkyy ARP liikennettä, sekä Nmapin lähettämä TCP liikenne, josta löytyy SYN ja SYN ACK lipuilla varustettu liikenne.

## c) nmap ping sweep -sn

Ping sweep `-sn` ei tee porttiskannausta vaan tulostaa ainoastaan verkossa saatavilla olevat koneet. 
Verkonskannausta voidaan rajoittaa eri IP-osoitteisiin määrittelemällä verkon numeron ja alueen joka halutaan skannata, tai käyttämällä verkkomaskia rajauksessa.
Ajoin skannauksen komennolla: `sudo nmap -sn 192.168.180.0-254`
Kyseinen komento tarkistaa IP-osoitteet 192.168.180.0 ja 192.168.180.254 väliltä.

![nmap5](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap5.png?raw=true)

Wireshark kaappaus.

![nmap6](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap6.png?raw=true)

Wireshark kappauksen perusteella Nmap lähettää ARP kyselyitä verkkoon, joissa se kysyy kenen IP-osoite on seuraavanlainen ja pyytää palauttamaan ARP-vastauksen takaisin skannaavalle koneelle. Rivillä 59 näkyy vastaus Metasploitable 2 koneelta.

## d) nmap don't ping -Pn

Ajoin skannauksen komennolla: `sudo nmap -Pn 192.168.180.5`. Kyseinen komento tarkistaa IP-osoitteet 192.168.180.1 ja 192.168.180.255 väliltä. Toinen tapa olisi ollut käyttää verkkomaskia, kun kohdennetaan skannauksen aluetta.
Kohdensin skannauksen Metasploitable 2 koneeseen.

![nmap7](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap7.png?raw=true)

Wireshark kaappaus.

![nmap8](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap8.png?raw=true)

Liikenne alkoi ARP kyselyillä joissa varmistettiin kohde. Varmistamisen jälkeen lähetettiin Kali koneesta Nmapilla TCP SYN liikennettä Metasploitable 2 koneeseen, johon Metasploitable 2 alkoi vastaamaan rivillä 17.


## e) nmap version detection -sV (esimerkki yhdestä palvelusta yhdessä portissa riittää)

Päätin tarkistaa tehtävissä aikaisemmin skannaamani Apachen version, kyseinen palvelu vastaa portista 80, joten kohdensin skannauksen siihen porttiin.
Ajoin skannauksen komennolla: `sudo nmap -sV -p 80 192.168.180.5`

![nmap9](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap9.png?raw=true)

Skannauksesta käy ilmi, että kyseisessä kohteessa on käytössä Apache httpd versio 2.2.8. ((Ubuntu) kohdasta voisi päätellä, että kyseessä on Linux kone, jossa ajetaan Ubuntu käyttöjärjestelmää.

Wireshark kaappaus.

![nmap10](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap10.png?raw=true)

Wireshark lähetti alussa ARP kyselyn.  Jossa se kysyi kuka on 192.168.180.5? Tämän jälkeen se lähetti TCP liikennettä kohteeseen. TCP liikenteen jälkeen näkyi myös HTTP liikennettä.

## f) nmap porttien valinta -p1-100, --top-ports 5, -p

Nmapilla voidaan valita kohteen porteista halutut skannattavat portit, näihin voidaan käyttää -p lisäystä komennossa, ja sen jälkeen määritellä skannattava portti. Lisätietoja löysin täältä [Nmapin sivuilta](https://nmap.org/book/performance-port-selection.html). Kohteet voidaan skannata top listauksen avulla, jossa on määriteltynä yleisesti avoinna olevat portit kohteessa. Top listaus perustuu tietoon, jota on kerätty porttiskannausten avulla.

    -p1-100
Skannaa portit 1-100 portin väliltä. 

    --top-ports 5
Skannaa 5 suosituinta porttia

    -p
Skannaa määritellyn portin esimerkiksi `-p 80`, skannaa portin 80 kohteesta.

Esimerkiksi toteutin kaikki nämä skannaukset Metasploitable 2 koneeseen seuraavanlaisesti.
Ajoin skannauksen komennolla: `sudo nmap -p1-100 192.168.180.5`.

![nmap11](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap11.png?raw=true)

 Ajoin skannauksen komennolla: `sudo nmap -top-ports 5 192.168.180.5`.
 
![nmap12](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap12.png?raw=true)

Ajoin skannauksen komennolla: `sudo nmap -p 80 192.168.180.5`.

![nmap13](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap13.png?raw=true)


## g) nmap IP-osoitteiden valinta; luettelo, verkkomaskilla 10.10.10.0/24, alku- ja loppuosoitteella 10.10.10.100-130 (ipcalc auttaa ymmärtämään, miten verkkomaskia tulkitaan)

Nmapin IP-osoitteiden valinnasta löysin tietoa Nmapin [verkkosivuilta](https://nmap.org/book/man-target-specification.html). 

Nmapilla voidaan valita skannattavia kohteita IP-osoitteiden avulla seuraavanlaisesti.

 - Suora IP-osoite: 192.168.180.5
 - Verkkomaskin avulla: 192.168.180.0/24
 - Rajaamalla skannattavat IP-osoitteet: 192.168.180.1-10, jossa se skannaa 192.168.180.1- 192.168.180.10 väliset IP-osoitteet.
 - Erottamalla IP-osoitteet pilkulla: 192.168.180.1,2,3,4



## h) nmap output files -oA foo. Mihin kukin tiedostotyyppi sopii?

Hain tietoa tähän kohtaan [nmapin sivuilta](https://nmap.org/book/man-output.html). `-oA` tulostaa tiedot kolmeen eri formaattiin.
Ennen testin suorittamista loin uuden kansion komennolla: `sudo mkdir h4`. Sen jälkeen siirryin kyseiseen hakemistoon.
Testissä suoritin skannauksen komennon: `sudo nmap -p 80 192.168.180.5 -oA h4h`. Skannauksen tulokset tulostuvat kolmeen eri **h4h** formaattiin kansioon **h4**.

![nmap14](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap14.png?raw=true)

Tiedostojen tulosteet:
**h4h.gnmap**
Grepattu "lyhennetty" versio .nmap tiedostosta.

![nmaph41](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmaph41.png?raw=true)

**h4h.nmap**
Nmapin oma tiedostomuoto, mistä löytyy sama teksti kuin alkuperäisestä skannauksesta.

![nmaph42](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmaph42.png?raw=true)

**h4h.xml**
Tulosteena raportti HTML ystävällisessä muodossa.

![nmaph43](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmaph43.png?raw=true)



## k) nmap ajonaikaiset toiminnot (man nmap: runtime interaction): verbosity v/V, help ?, packet tracing p/P, status s (ja moni muu nappi)

Löysin tietoa [nmapin sivuilta](https://nmap.org/book/man-runtime-interaction.html) ajonaikaisista toiminnoista seuraavanlaisesti:
> v / V 
> Increase / decrease the verbosity level
>  d / D
>  Increase /decrease the debugging Level
>  p / P
>  Turn on / off packet tracing 
>  ?
> Print a runtime interaction help screen

Ajonaikana voidaan lisätä tulostettavien rivien määrää, tämän lisäksi debug ominaisuudella nähdään, mitä ohjelma tekee.
On myös mahdollista seurata pakettien kulkua. `?` saadaan lisätietoa ja apua ajonaikaisista toiminnoista ajonaikana.
Esimerkkinä näiden käytöstä ajoin skannauksen komennolla: `sudo nmap -sV 192.168.180.5`. Skannauksen aikana painoin v, d, p ja loppuvaiheessa `?`. `?` kertoi samat asiat kuin aikaisemmin mainitulla Nmapin sivustolla.

![nmap15](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap15.png?raw=true)

![nmap16](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap16.png?raw=true)



## l) normaalisti 'sudo nmap'. Miten nmap toiminta eroaa, jos sitä ajaa ilman sudoa? Suorita ja analysoi esimerkki.

Aloitin testin ajamalla sudona nmapin ja kaappaamalla sen verkkoliikennettä Wiresharkilla, jonka jälkeen suoritin saman ilman sudo oikeuksia. 
Ajoin molemmissa tilanteissa komennon: `nmap -p 80 192.168.180.5`.
Ajoin komennon sudona: `sudo nmap -p 80 192.168.180.5`.

![nmap17](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap17.png?raw=true)

![nmap18](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap18.png?raw=true)

Ilman sudo oikeuksia komennolla: `nmap -p 80 192.168.180.5`.

![nmap19](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap19.png?raw=true)

![nmap20](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap20.png?raw=true)

**Johtopäätös**
Huomasin saman tien itse Nmapin skannauksen lopputuloksessa yhden eron, ilman sudo oikeuksia ajettuna se ei pysty päättelemään MAC-osoitetta kohteesta. Saman asian myös huomasi, kun katsoi Wiresharkin liikenteenkaappausta. Sieltä ei löytynyt ARP-kyselyitä, kun ajettiin skannaus ilman sudo oikeuksia.

En suoralta silmäilyltä huomannut muita muutoksia tässä tehtävässä.

## m) nmap, vertaile -sV vs -A kestoa (ja lähetetyn datan määrää jos osaat; time, nethogs, wireshark). Käytä harjoitusmaalina metasploitable2.

Päätin vertailla molempien kestoa skannausraportin ilmoittaman ajan perusteella, sekä Wireshark ohjelmalla kaapatun datan määrällä.
Kohdensin skannauksen maaliksi Metasploitable 2 koneen, joka löytyy IP-osoitteen: 192.168.180.5 takaa.

**-sV**
Ajoin skannauksen komennolla: `sudo nmap -sV 192.168.180.5`

![nmap21](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap21.png?raw=true)

Tämän jälkeen siirryin Wireshark ohjelmaan sulkemaan verkkoliikenteen seurannan.

![nmap22](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap22.png?raw=true)

Löysin Wireshark ohjelman yläpalkki kohdasta "Statistics" kohdan nimeltä Capture File Properties. Kyseisen kohdan lopussa löytyi tietoa juuri tehdystä verkkoliikenteen kaappauksesta.

**-A**
Ajoin skannauksen komennolla: `sudo nmap -A 192.168.180.5`

![nmap23](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap23.png?raw=true)

![nmap24](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap24.png?raw=true)

Wireshark kaappaus.
![nmap25](https://github.com/nikhuk/pentest/blob/main/assets/h4/nmap25.png?raw=true)

**Vertailu**
Selkeästi ensimmäinen skannaus `-sV` oli nopeampi, kuin `-A` skannaus. 
`-sV` skannauksessa kesti Nmapin mukaan 25.23 sekuntia.
`-A` skannaus kesti jopa 65.71 sekuntia, eli lähestulkoon kaksi kertaa kauemmin.

Lähetetyn datan määrässä Wiresharkin mukaan `-sV` käytti 206700 tavua, kun taas `-A` skannaus käytti 624824 tavua.

**Lopputulos**
`-A` skannaus oli yli kaksi kertaa hitaampi, sekä lähetti enemmän tavuja melkein jopa kolme kertaa enemmän.
`-sV` skannaus oli nopeampi ja lähetettävän datan määrä oli huomattavasti pienempi.

## d) Ninjojen tapaan. Piiloutuuko nmap-skannaus hyvin palvelimelta? Vinkkejä: Asenna Apache. Aja nmap-versioskannaus -sV omaan paikalliseen weppipalvelimeen. Etsi Apachen lokista tätä koskevat rivit. Wiresharkissa "http" on kätevä filtteri, se tulee siihen yläreunan "Apply a display filter..." -kenttään. Nmap-ajon aikana p laittaa packet tracing päälle. Vapaaehtoinen lisäkohta: jääkö Apachen lokiin jokin todiste nmap-versioskannauksesta?

Kali virtuaalikoneesani oli valmiiksi asennettuna Apache 2 demoni, joten tarkistin vain seuraavaksi onko se päällä.
Ajoin seuraavan komennon: `sudo systemctl status apache2`.
Selvisi että kyseinen prosessi on kuollut ja epäaktiivinen, joten seuraavaksi ajoin komennon: `sudo systemctl restart apache2`.
Tarkistin vielä uudelleen sen, että kyseinen prosessi on käynnissä komennolla: `sudo systemctl status apache2`.

![apache1](https://github.com/nikhuk/pentest/blob/main/assets/h4/apache1.png?raw=true)
 
 Seuraavaksi testasin vielä Firefox selaimella avata localhost sivua.
 ![apache2](https://github.com/nikhuk/pentest/blob/main/assets/h4/apache2.png?raw=true)

Apache oli lähtenyt käyntiin ja ilmoitti olevan toiminnassa, joten pystyin jatkamaan tehtävässä eteenpäin.
Varmistin vielä tässä vaiheessa VBox:in asetuksista, että kone oli kytketty pois verkosta.
Käynnistin Wiresharkin ja valitsin seurattavaksi adapteriksi Loopback:Io.
Seuraavaksi siirryin käyttämään Nmappia. Ajoin skannauksen seuraavanlaisella komennolla: `sudo nmap -sV -p 80 localhost`.

![apache3](https://github.com/nikhuk/pentest/blob/main/assets/h4/apache3.png?raw=true)

Tuloksena selviää Apachen versio on 2.4.52, ajettava käyttöjärjestelmä on Debian. 

Wireshark kaappauksen tiedot:
**HTTP filtterillä filtteröity liikenne.**

![apache4](https://github.com/nikhuk/pentest/blob/main/assets/h4/apache4.png?raw=true)

Riviltä 7 löytyi seuraavanlainen GET pyyntö

![apache5](https://github.com/nikhuk/pentest/blob/main/assets/h4/apache5.png?raw=true)

Vastaus rivin 7 GET pyyntöön löytyy riviltä 9.

![apache6](https://github.com/nikhuk/pentest/blob/main/assets/h4/apache6.png?raw=true)

Vastauksessa käy ilmi käytettävä Apachen versio, sekä Debian käyttöjärjestelmä kohdasta **Server:**.

**Lokitiedostot**

Seuraavaksi päätin tarkastella Apachen lokeja, nämä löytyivät seuraavanlaisesta polusta /var/log/apache2 ja tiedostosta access.log. 
Tulostin access.log tiedoston komennolla: `cat access.log`.

![apache7](https://github.com/nikhuk/pentest/blob/main/assets/h4/apache7.png?raw=true)

Tiedostosta näkee sen että, nmap versioskannauksesta jää jälki access.log tiedostoon. Tiedoston mukaan skannaus on tapahtunut 20:39 aikaan.

## UDP-skannaus. "Mulla olis vitsi UDP:sta, mutta en tiedä menisikö se perille":

## e) Mitkä ovat tavallisimmat tai kiinnostavimmat palvelut, joita UDP-skannauksella voisi löytää? (tässä alakohdassa vain vastaus viitteineen, ei tarvita testiä tietokoneella)
Löysin listan tunnetuista ja käytetyistä porteista tästä [artikkelista](https://www.pearsonitcertification.com/articles/article.aspx?p=1868080).

**DNS** portti 53. Nimipalvelu, jonka tarkoituksena on muuntaa numeeriset IP-osoitteet, ihmisille helpommin ymmärrettäväksi.
**DHCP** porttit 67/68. on palvelu, joka jakaa IP-osoitteita päätelaitteille.
**SNMP** portit 161/162. Verkossa käytettävä protokolla, jolla voidaan kysellä laitteiden tilaa tai laitteet voivat ilmoittaa omasta tilastaan.

Itselleni kaksi ensimmäistä ovat hyvin tuttuja UDP-palveluita.



## f) Miksi UDP-skannaus on hankalaa ja epäluotettavaa? Miksi UDP-skannauksen kanssa kannattaa käyttää --reason flagia? (tässä alakohdassa vain vastaus viitteineen, ei tarvita testiä tietokoneella)

UDP protokolla eroaa TCP protokollasta sitten, että siinä ei ole jatkuvaa yhteyttä laitteiden välillä. Tämä voi aiheuttaa epäluotettavia tietoja skannausta tehdessä. Yhteydetön protokolla myös saattaa hukata paketteja, koska niitä ei tarkisteta samalla tavalla, kuin TCP liikenteessä. Lisävastauksia löysin [Nmap](https://nmap.org/book/man-port-scanning-techniques.html) sivustolta. Jossa kuvaillaan suureksi haasteeksi sitä, että se vie paljon aikaa. Myös kun paketteja lähetetään UDP portteihin, vastauksessa voi kestää hyvin kauan.

[Nmapin](https://nmap.org/book/port-scanning-options.html) mukaan --reason lisää rivin, jossa kuvaillaan syytä miksi kyseinen päätelmä on tehty portista. Se voi hyvin avata syytä, että miksi jokin portti ilmoittaa itsestään virheellisen vastauksen, vaikka siellä olisikin palvelu valmiina vastaamaan.

## Aktiivista tiedustelua. Mihin tämä työkalu on tarkoitettu? Kokeile tätä työkalua omaan harjoitusmaaliin ja selitä tulokset:

## h) fuff (hakemistojen kokeilu riittää, vapaaehtoisena bonuksena muutakin)

Lähdin kokeilemaan FuFF työkalua asentamalla sen seuraavanlaisesti:

    sudo apt-get update
    sudo apt-get install ffuf
Kyseinen työkalu ei ollut minulle entuudestaan tuttu, joten kävin etsimässä siitä lisää tietoa [täältä](https://github.com/ffuf/ffuf#example-usage).

FFuF käyttö oli myös hiukan hakusessa, joten kävin katsomassa GitHubista löytyvän [linkin](https://codingo.io/tools/ffuf/bounty/2020/09/17/everything-you-need-to-know-about-ffuf.html) takaa, kuinka FFuF työkalua käytetään.

Latasin FFuF käyttöä varten sanalistan [GitHubista](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/directory-list-2.3-small.txt), jota suositeltiin yllä olevassa ohjeessa.

Seuraavaksi ajoin FFuF työkalun ja kohteeksi valitsin Metasploitable 2 koneen.

    ffuf -w wordlist.txt -u http://192.168.180.5/FUZZ


![ffuf](https://github.com/nikhuk/pentest/blob/main/assets/h4/ffuf.png?raw=true)

FFuF löysi tietoja esimerkiksi phpinfo sivusta, mistä selviää lisätietoja kohdelaittessa olevasta pHp ohjelmistosta.

## i) nikto

Niktolla voidaan skannata haavoittuvuuksia kohteesta.
Lähdin kokeilemaan Niktoa työkalua asentamalla sen seuraavanlaisesti:

    sudo apt-get update
    sudo apt-get install nikto
Kyseinen työkalu ei ollut minulle entuudestaan tuttu, joten kävin etsimässä siitä lisää tietoa [täältä.](https://github.com/sullo/nikto)

Ajoin nikton haavoittuvuus skannauksen Metasploitable 2 koneeeseen komennolla: `nikto -h 192.168.180.5`.

![nikto](https://github.com/nikhuk/pentest/blob/main/assets/h4/nikto.png?raw=true)

![nikto2](https://github.com/nikhuk/pentest/blob/main/assets/h4/nikto2.png?raw=true)


Nikton avulla löytyi mahdollinen haavoittuvuus Apachen versiosta ja tietoja esimerkiksi phpMyAdminista.



## j) Pizza fantasia: jokin valitsemasi tiedustelutyökalu, esimerkiksi EyeWitness, wpscan, openvas, nucleus tai jokin muu.

EyeWitnessin avulla voidaan skannata HTML sivustoja ja ottaa niistä kuvakaappauksia. Kyseisestä ohjelmasta on paljon hyötyä, jos kohteessa on paljon erilaisia HTML sivustoja.

Lähdin kokeilemaan EyeWitness työkalua asentamalla sen seuraavanlaisesti:

    sudo apt-get update
    sudo apt-get install eyewitness
Kyseinen työkalu ei ollut minulle entuudestaan tuttu, joten kävin etsimässä siitä lisää tietoa [täältä.](https://www.kali.org/tools/eyewitness/)

Loin ensimmäisenä tekstitiedoston, jossa on ainoastaan Metasploitable 2 koneen IP-osoite. 
Tämän jälkeen ajoin EyeWitness työkalun komennolla: `eyewitness -f meta`.

![eyewitness1](https://github.com/nikhuk/pentest/blob/main/assets/h4/eyewitness1.png?raw=true)

Sain ilmoituksen että raportti on valmis, sekä sen että mistä se löytyy.

![eyewitness2](https://github.com/nikhuk/pentest/blob/main/assets/h4/eyewitness2.png?raw=true)

Raportissa näkyy kuvankaappaus Metasploitable koneen verkkosivusta, sekä tietoja sivustosta.

## Lähteet

 - https://terokarvinen.com/2021/penetration-testing-course-2022-spring/
 - https://learning.oreilly.com/videos/the-art-of/9780135767849/9780135767849-SPTT_04_00
 - https://nmap.org/book/nmap-overview-and-demos.html
 - https://nmap.org/book/man.html
 - https://nmap.org/book/man-port-scanning-basics.html
 - https://nmap.org/book/man-port-scanning-techniques.html
 - https://www.techopedia.com/definition/10339/three-way-handshake
 - https://nmap.org/book/man-host-discovery.html
 - https://nmap.org/book/port-scanning-options.html
 - https://www.pearsonitcertification.com/articles/article.aspx?p=1868080
 - https://github.com/ffuf/ffuf#example-usage
 - https://codingo.io/tools/ffuf/bounty/2020/09/17/everything-you-need-to-know-about-ffuf.html
 - https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/directory-list-2.3-small.txt
 - https://github.com/sullo/nikto
 - https://www.kali.org/tools/eyewitness/